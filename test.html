<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ©</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  body { margin: 0; padding: 20px; font-family: "Cairo", sans-serif; background-color: #0f0f1a; color: white; min-height: 100vh; display: flex; flex-direction: column; align-items: center; }
  
  .stats-card { background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); padding: 30px; border-radius: 40px; text-align: center; box-shadow: 0 0 50px rgba(102, 126, 234, 0.15); width: 90%; max-width: 600px; margin-bottom: 20px; }
  .number-display { font-size: 5rem; font-weight: 900; background: linear-gradient(to bottom, #4facfe 0%, #00f2fe 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; line-height: 1; margin: 10px 0; }
  
  .msg-card { background: #fff; color: #333; width: 90%; max-width: 600px; padding: 20px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); margin-bottom: 20px; }
  h2 { margin: 0 0 15px 0; color: #4facfe; text-align: center; }
  .msg-input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 10px; font-size: 1rem; font-family: inherit; box-sizing: border-box; margin-bottom: 10px; }
  .send-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #ff9800 0%, #ff5722 100%); color: white; border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold; cursor: pointer; transition: 0.3s; }
  .send-btn:hover { transform: scale(1.02); }
  
  .quick-replies { display: flex; flex-direction: column; gap: 8px; margin-top: 15px; border-top: 1px solid #eee; padding-top: 15px; }
  .template-btn { background: #f0f2f5; border: none; padding: 10px; border-radius: 8px; cursor: pointer; text-align: right; transition: 0.2s; font-size: 0.9em; display: flex; align-items: center; gap: 8px; }
  .template-btn:hover { background: #e0e7ff; color: #4facfe; }

  /* --- ØªØµÙ…ÙŠÙ… Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ø¬Ù„ --- */
  .log-container { width: 90%; max-width: 800px; background: rgba(0,0,0,0.3); border-radius: 20px; padding: 20px; border: 1px solid #333; }
  .log-table { width: 100%; border-collapse: collapse; font-size: 0.9em; }
  .log-table th { text-align: right; padding: 10px; border-bottom: 2px solid #444; color: #888; }
  .log-table td { padding: 12px 10px; border-bottom: 1px solid #333; vertical-align: middle; }
  .log-row { transition: 0.3s; animation: fadeIn 0.5s ease; }
  .log-row:hover { background: rgba(255,255,255,0.05); }
  .status-badge { padding: 4px 8px; border-radius: 6px; font-weight: bold; font-size: 0.8em; }
  .status-valid { background: rgba(46, 125, 50, 0.2); color: #66bb6a; border: 1px solid #2e7d32; }
  .status-invalid { background: rgba(198, 40, 40, 0.2); color: #ef5350; border: 1px solid #c62828; }
  .voter-name { font-weight: bold; color: #fff; display: block; }
  .voter-time { font-size: 0.75em; color: #777; }
  .candidate-pill { display: inline-block; background: #222; border: 1px solid #444; padding: 2px 8px; border-radius: 10px; margin: 2px; font-size: 0.85em; }
  
  @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
</style>
</head>
<body>

<div class="stats-card">
  <div style="font-size: 1.2rem; color: #ccc;">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
  <div class="number-display" id="count-display">0</div>
</div>

<div class="msg-card">
  <h2>ğŸ“¢ Ø¥Ø±Ø³Ø§Ù„ ØªÙ†Ø¨ÙŠÙ‡ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h2>
  <input type="text" id="msg-input" class="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‡Ù†Ø§ Ø£Ùˆ Ø§Ø®ØªØ± Ù‚Ø§Ù„Ø¨Ø§Ù‹...">
  <button class="send-btn" id="send-btn">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© ÙÙˆØ±Ø§Ù‹ ğŸš€</button>
  <div style="display:none; text-align:center; color:green; margin-top:5px;" id="status-msg">ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„!</div>
  
  <div class="quick-replies">
      <div style="font-size:0.8em; color:#999; font-weight:bold; margin-bottom:5px;">Ø±Ø³Ø§Ø¦Ù„ Ø¬Ø§Ù‡Ø²Ø©:</div>
      <button class="template-btn" onclick="fillMsg('Ø§Ù‡Ù„Ø§ ÙˆÙ…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙ‰ Ù…Ø¤ØªÙ…Ø± Ø¯Ø¹Ù… Ø§Ù„Ø­Ø§Ø¬ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ')">
          <span>ğŸ‘‹</span> Ø§Ù‡Ù„Ø§ ÙˆÙ…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙ‰ Ù…Ø¤ØªÙ…Ø± Ø¯Ø¹Ù… Ø§Ù„Ø­Ø§Ø¬ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ
      </button>
      <button class="template-btn" onclick="fillMsg('Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙŠØ§Ø±ÙŠØª ÙƒÙ„Ù†Ø§ Ù†Ù‡ØªÙ… Ø´ÙˆÙŠØ© ÙŠØ§Ø¬Ù…Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ø°Ù†ÙƒÙ…')">
          <span>âš ï¸</span> Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙŠØ§Ø±ÙŠØª ÙƒÙ„Ù†Ø§ Ù†Ù‡ØªÙ… Ø´ÙˆÙŠØ© ÙŠØ§Ø¬Ù…Ø§Ø¹Ø©
      </button>
      <button class="template-btn" onclick="fillMsg('Ø´ÙƒØ±Ø§ Ù„ØªØ¹Ø¨ÙƒÙ… ÙˆØ¯Ø¹Ù…ÙƒÙ… Ù„Ù„Ø­Ø§Ø¬ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ')">
          <span>â¤ï¸</span> Ø´ÙƒØ±Ø§ Ù„ØªØ¹Ø¨ÙƒÙ… ÙˆØ¯Ø¹Ù…ÙƒÙ… Ù„Ù„Ø­Ø§Ø¬ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ
      </button>
  </div>
</div>

<div class="log-container">
    <h3 style="margin:0 0 15px 0; color:#fff;">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3>
    <table class="log-table">
        <thead>
            <tr>
                <th>Ø§Ù„Ù†Ø§Ø®Ø¨ / Ø§Ù„ÙˆÙ‚Øª</th>
                <th>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</th>
                <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
            </tr>
        </thead>
        <tbody id="log-body">
            </tbody>
    </table>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue, set, query, limitToLast, onChildAdded } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAoZE2KL3APojd929VEbhSv914jzDv90wA",
    authDomain: "test-dd8b4.firebaseapp.com",
    databaseURL: "https://test-dd8b4-default-rtdb.firebaseio.com",
    projectId: "test-dd8b4",
    storageBucket: "test-dd8b4.firebasestorage.app",
    messagingSenderId: "761689441004",
    appId: "1:761689441004:web:667a3fae42f3cf84071bc9",
    measurementId: "G-PP1BG203MT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // 1. Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
  onValue(ref(db, 'stats/logins'), (snap) => {
    document.getElementById("count-display").innerText = snap.val() || 0;
  });

  // 2. Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
  window.fillMsg = function(text) {
      document.getElementById("msg-input").value = text;
  }
  document.getElementById("send-btn").addEventListener("click", () => {
    const input = document.getElementById("msg-input");
    if (!input.value.trim()) return;
    set(ref(db, 'broadcast_message'), { text: input.value.trim(), timestamp: Date.now() });
    input.value = "";
    document.getElementById("status-msg").style.display = "block";
    setTimeout(()=>document.getElementById("status-msg").style.display="none", 2000);
  });

  // 3. --- [Ø¬Ø¯ÙŠØ¯] Ø§Ù„Ø§Ø³ØªÙ…Ø§Ø¹ Ù„Ø³Ø¬Ù„ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ø­ÙŠ ---
  const votesRef = query(ref(db, 'votes'), limitToLast(50)); // Ø¬Ù„Ø¨ Ø¢Ø®Ø± 50 Ø¹Ù…Ù„ÙŠØ© ÙÙ‚Ø·
  const logBody = document.getElementById("log-body");

  onChildAdded(votesRef, (snapshot) => {
      const data = snapshot.val();
      if(!data) return;

      const row = document.createElement("tr");
      row.className = "log-row";
      
      const timeStr = new Date(data.timestamp).toLocaleTimeString('ar-EG');
      const statusClass = data.status === "ØµØ­ÙŠØ­" ? "status-valid" : "status-invalid";
      
      // ØªÙ†Ø³ÙŠÙ‚ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø´Ø­ÙŠÙ†
      let candidatesHtml = "";
      if(data.candidates && Array.isArray(data.candidates)){
          data.candidates.forEach(c => {
              candidatesHtml += `<span class="candidate-pill">${c}</span>`;
          });
      }

      row.innerHTML = `
          <td>
              <span class="voter-name">${data.name}</span>
              <span class="voter-time">${timeStr}</span>
          </td>
          <td>${candidatesHtml}</td>
          <td><span class="status-badge ${statusClass}">${data.status}</span></td>
      `;
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØµÙ ÙÙŠ Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ (Ø§Ù„Ø£Ø­Ø¯Ø« ÙÙˆÙ‚)
      logBody.prepend(row);
  });
</script>

</body>
</html>
