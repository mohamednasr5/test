<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>Ø´Ø§Ø´Ø© Ø§Ù„ØªØ­ÙƒÙ… Ø§Ù„Ù…Ø±ÙƒØ²ÙŠØ© | Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;800&display=swap" rel="stylesheet">

<style>
    :root {
        --primary-bg: #0f0f1a;
        --card-bg: rgba(255, 255, 255, 0.03);
        --glass-border: rgba(255, 255, 255, 0.08);
        --accent-color: #4facfe;
        --success-color: #43e97b;
        --danger-color: #ff576c;
        --neon-glow: 0 0 20px rgba(79, 172, 254, 0.3);
    }

    * { box-sizing: border-box; outline: none; }

    body {
        margin: 0;
        padding: 20px;
        font-family: "Cairo", sans-serif;
        background-color: var(--primary-bg);
        background-image: 
            radial-gradient(circle at 10% 20%, rgba(79, 172, 254, 0.1) 0%, transparent 20%),
            radial-gradient(circle at 90% 80%, rgba(255, 87, 108, 0.08) 0%, transparent 20%);
        color: white;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        align-items: center;
        overflow-x: hidden;
    }

    ::-webkit-scrollbar { width: 8px; }
    ::-webkit-scrollbar-track { background: #0f0f1a; }
    ::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

    /* --- QR Section --- */
    .qr-section {
        background: rgba(255, 255, 255, 0.05);
        backdrop-filter: blur(10px);
        border: 1px solid var(--glass-border);
        padding: 25px;
        border-radius: 25px;
        margin-bottom: 35px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        animation: floatDown 1s ease-out;
        max-width: 95%;
        width: 400px;
        position: relative;
        overflow: hidden;
    }
    .qr-section::before {
        content: ''; position: absolute; top: 0; left: -100%; width: 50%; height: 100%;
        background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
        transform: skewX(-25deg); animation: shine 3s infinite;
    }
    .qr-title { color: #fff; font-weight: 700; margin-bottom: 20px; font-size: 1.2em; }
    .qr-img {
        width: 200px; height: 200px; border-radius: 15px; border: 4px solid rgba(255,255,255,0.8);
        padding: 5px; background: #fff; box-shadow: var(--neon-glow); transition: transform 0.3s ease;
    }
    .qr-img:hover { transform: scale(1.05); }

    /* --- Stats Grid --- */
    .stats-grid {
        display: grid; grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 20px; width: 100%; max-width: 900px; margin-bottom: 30px; padding: 0 10px;
    }
    .stat-card {
        background: var(--card-bg); backdrop-filter: blur(8px); border: 1px solid var(--glass-border);
        padding: 20px; border-radius: 20px; text-align: center; position: relative;
        overflow: hidden; transition: 0.3s; animation: fadeInUp 0.8s ease backwards;
    }
    .stat-card:nth-child(1) { animation-delay: 0.1s; border-bottom: 3px solid #00f2fe; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; border-bottom: 3px solid #f093fb; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; border-bottom: 3px solid #43e97b; }
    .stat-card:nth-child(4) { animation-delay: 0.4s; border-bottom: 3px solid #ff576c; }
    .stat-card:hover { transform: translateY(-10px); background: rgba(255,255,255,0.07); }
    .stat-title { font-size: 0.85em; color: #aaa; margin-bottom: 10px; font-weight: 600; }
    .stat-value { font-size: 2.5rem; font-weight: 800; line-height: 1.1; }
    
    .color-online { background: linear-gradient(to bottom, #00f2fe, #4facfe); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .color-total { background: linear-gradient(to bottom, #f093fb, #f5576c); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .color-valid { background: linear-gradient(to bottom, #43e97b, #38f9d7); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
    .color-invalid { background: linear-gradient(to bottom, #ff0844, #ffb199); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

    /* --- Msg Card --- */
    .msg-card {
        background: #fff; color: #333; width: 95%; max-width: 700px; padding: 25px;
        border-radius: 24px; box-shadow: 0 20px 50px rgba(0,0,0,0.4); margin-bottom: 30px;
        position: relative; z-index: 2; animation: zoomIn 0.6s ease;
    }
    .msg-input {
        width: 100%; padding: 15px; border: 2px solid #f0f0f0; border-radius: 12px;
        font-size: 1rem; font-family: inherit; background: #fafafa; margin-bottom: 15px;
    }
    .msg-input:focus { border-color: var(--accent-color); background: #fff; }
    .send-btn {
        width: 100%; padding: 15px; background: linear-gradient(135deg, #ff9966 0%, #ff5e62 100%);
        color: white; border: none; border-radius: 12px; font-size: 1.1rem; font-weight: bold;
        cursor: pointer; transition: 0.3s;
    }
    .send-btn:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(255, 94, 98, 0.6); }
    
    .quick-replies { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; border-top: 1px solid #f0f0f0; padding-top: 15px; }
    .template-btn {
        background: #f7f9fc; border: 1px solid #eef; padding: 8px 15px; border-radius: 20px;
        cursor: pointer; transition: 0.2s; font-size: 0.85em; flex: 1 1 auto; display: flex; align-items: center; justify-content: center; gap: 6px;
    }
    .template-btn:hover { background: #eef4ff; color: var(--accent-color); border-color: var(--accent-color); }

    /* --- Danger Zone (New) --- */
    .danger-card {
        background: rgba(255, 0, 0, 0.05); border: 1px solid rgba(255, 0, 0, 0.2);
        width: 95%; max-width: 700px; padding: 15px; border-radius: 15px; margin-bottom: 30px;
        display: flex; justify-content: space-between; align-items: center;
        backdrop-filter: blur(5px);
    }
    .danger-text { font-size: 0.9em; color: #ffb199; display: flex; align-items: center; gap: 10px; }
    .reset-btn {
        background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%);
        color: white; border: none; padding: 10px 20px; border-radius: 10px;
        font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(239, 71, 58, 0.3);
        transition: 0.3s; font-size: 0.9em;
    }
    .reset-btn:hover { transform: scale(1.05); box-shadow: 0 6px 20px rgba(239, 71, 58, 0.5); }

    /* --- Log Table --- */
    .log-container {
        width: 95%; max-width: 900px; background: rgba(20, 20, 30, 0.6); backdrop-filter: blur(15px);
        border-radius: 20px; border: 1px solid var(--glass-border); overflow: hidden;
        box-shadow: 0 10px 40px rgba(0,0,0,0.3); animation: fadeInUp 1s ease;
    }
    .table-wrapper { width: 100%; overflow-x: auto; max-height: 400px; overflow-y: auto; }
    .log-table { width: 100%; border-collapse: collapse; font-size: 0.95em; min-width: 600px; }
    .log-table th { text-align: right; padding: 15px; background: rgba(0,0,0,0.3); color: #888; position: sticky; top: 0; backdrop-filter: blur(5px); }
    .log-table td { padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05); color: #eee; }
    .log-row { animation: slideInRight 0.4s ease-out; }
    .status-badge { padding: 5px 12px; border-radius: 50px; font-weight: bold; font-size: 0.75em; }
    .status-valid { background: rgba(67, 233, 123, 0.15); color: #43e97b; border: 1px solid rgba(67, 233, 123, 0.3); }
    .status-invalid { background: rgba(255, 87, 108, 0.15); color: #ff576c; border: 1px solid rgba(255, 87, 108, 0.3); }
    .candidate-pill { display: inline-block; background: rgba(255,255,255,0.1); padding: 4px 10px; border-radius: 8px; margin: 2px; font-size: 0.85em; }

    /* Keyframes */
    @keyframes floatDown { from { opacity: 0; transform: translateY(-30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeInUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes zoomIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
    @keyframes slideInRight { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes shine { 0% { left: -100%; } 20% { left: 100%; } 100% { left: 100%; } }

    /* Responsive */
    @media (max-width: 600px) {
        .stats-grid { grid-template-columns: 1fr 1fr; }
        .danger-card { flex-direction: column; gap: 10px; text-align: center; }
    }
    @media (max-width: 400px) { .stats-grid { grid-template-columns: 1fr; } }
</style>
</head>
<body>

<div class="qr-section">
    <div class="qr-title">ğŸ“± Ø§Ù…Ø³Ø­ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„ØªØµÙˆÙŠØª</div>
    <img src="https://raw.githubusercontent.com/mohamednasr5/test/74daa60a86586d7d1b7f0215a0262a3761a0ba43/4.jpeg" alt="QR Code" class="qr-img">
</div>

<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-title">Ø§Ù„Ù…ØªÙˆØ§Ø¬Ø¯ÙˆÙ† Ø§Ù„Ø¢Ù† ğŸ”´</div>
        <div class="stat-value color-online" id="online-count">0</div>
        <div style="font-size:0.7em; color:rgba(255,255,255,0.5); margin-top:5px;">ØªØ­Ø¯ÙŠØ« Ù„Ø­Ø¸ÙŠ</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø£ØµÙˆØ§Øª ğŸ—³ï¸</div>
        <div class="stat-value color-total" id="total-votes">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Ø£ØµÙˆØ§Øª ØµØ­ÙŠØ­Ø© âœ…</div>
        <div class="stat-value color-valid" id="valid-votes">0</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">Ø£ØµÙˆØ§Øª Ø¨Ø§Ø·Ù„Ø© âŒ</div>
        <div class="stat-value color-invalid" id="invalid-votes">0</div>
    </div>
</div>

<div class="msg-card">
    <h2>ğŸ“¢ ØºØ±ÙØ© Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ø¨Ø«</h2>
    <input type="text" id="msg-input" class="msg-input" placeholder="Ø§ÙƒØªØ¨ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..." autocomplete="off">
    <button class="send-btn" id="send-btn">Ø¥Ø±Ø³Ø§Ù„ Ù„Ù„Ø¬Ù…ÙŠØ¹ ğŸš€</button>
    <div style="display:none; text-align:center; color:#2ecc71; margin-top:10px; font-weight:bold;" id="status-msg">âœ¨ ØªÙ… Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨Ù†Ø¬Ø§Ø­</div>
    
    <div class="quick-replies">
        <button class="template-btn" onclick="fillMsg('Ø§Ù‡Ù„Ø§ ÙˆÙ…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙÙ‰ Ù…Ø¤ØªÙ…Ø± Ø¯Ø¹Ù… Ø§Ù„Ø­Ø§Ø¬ Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ')">ğŸ‘‹ ØªØ±Ø­ÙŠØ¨ Ø¨Ø§Ù„Ù…Ø¤ØªÙ…Ø±</button>
        <button class="template-btn" onclick="fillMsg('Ù…Ø±Ø­Ø¨Ø§ Ø¨ÙƒÙ… ÙŠØ§Ø±ÙŠØª ÙƒÙ„Ù†Ø§ Ù†Ù‡ØªÙ… Ø´ÙˆÙŠØ© ÙŠØ§Ø¬Ù…Ø§Ø¹Ø© Ø¨Ø¹Ø¯ Ø§Ø°Ù†ÙƒÙ…')">âš ï¸ ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ø§Ù…</button>
        <button class="template-btn" onclick="fillMsg('Ø´ÙƒØ±Ø§ Ù„ØªØ¹Ø¨ÙƒÙ… ÙˆØ¯Ø¹Ù…ÙƒÙ… Ù„Ù„Ø­Ø§Ø¬ Ø§Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯ÙŠ')">â¤ï¸ Ø±Ø³Ø§Ù„Ø© Ø´ÙƒØ±</button>
    </div>
</div>

<div class="danger-card">
    <div class="danger-text">
        <span>âš™ï¸</span>
        <span>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (ØªØ­Ø°ÙŠØ±: Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹)</span>
    </div>
    <button class="reset-btn" id="reset-data-btn">ğŸ—‘ï¸ ØªØµÙÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª</button>
</div>

<div class="log-container">
    <h3 style="padding:20px; margin:0; border-bottom:1px solid rgba(255,255,255,0.1);">ğŸ“‹ Ø³Ø¬Ù„ Ø§Ù„ØªØµÙˆÙŠØª Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h3>
    <div class="table-wrapper">
        <table class="log-table">
            <thead>
                <tr><th>Ø§Ù„Ù†Ø§Ø®Ø¨ / Ø§Ù„ÙˆÙ‚Øª</th><th>Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª</th><th>Ø§Ù„Ø­Ø§Ù„Ø©</th></tr>
            </thead>
            <tbody id="log-body"></tbody>
        </table>
    </div>
</div>

<script type="module">
  // Ø¥Ø¶Ø§ÙØ© remove Ù„Ù„Ø§Ø³ØªÙŠØ±Ø§Ø¯
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getDatabase, ref, onValue, set, query, limitToLast, onChildAdded, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

  const firebaseConfig = {
    apiKey: "AIzaSyAoZE2KL3APojd929VEbhSv914jzDv90wA",
    authDomain: "test-dd8b4.firebaseapp.com",
    databaseURL: "https://test-dd8b4-default-rtdb.firebaseio.com",
    projectId: "test-dd8b4",
    storageBucket: "test-dd8b4.firebasestorage.app",
    messagingSenderId: "761689441004",
    appId: "1:761689441004:web:667a3fae42f3cf84071bc9",
    measurementId: "G-PP1BG203MT"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);

  // ÙƒÙˆØ¯ ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
  document.getElementById("reset-data-btn").addEventListener("click", () => {
      // Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
      if (confirm("âš ï¸ ØªØ­Ø°ÙŠØ± Ù‡Ø§Ù…!\n\nÙ‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø£ØµÙˆØ§Øª ÙˆØ§Ù„Ø³Ø¬Ù„Ø§ØªØŸ\nÙ„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ±Ø§Ø¬Ø¹ Ø¹Ù† Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©!")) {
          // ÙƒÙˆØ¯ Ø§Ù„Ø­Ø°Ù Ø§Ù„ÙØ¹Ù„ÙŠ Ù…Ù† ÙØ§ÙŠØ±Ø¨ÙŠØ²
          remove(ref(db, 'votes'))
            .then(() => {
                alert("ØªÙ… ØªØµÙÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­! âœ…");
                // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ù„ØªÙ†Ø¸ÙŠÙ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨ØµØ±ÙŠØ§Ù‹
                location.reload();
            })
            .catch((error) => {
                alert("Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù: " + error.message);
            });
      }
  });

  onValue(ref(db, 'presence'), (snap) => {
    document.getElementById("online-count").innerText = snap.size;
  });

  onValue(ref(db, 'votes'), (snap) => {
      let total = 0; let valid = 0; let invalid = 0;
      snap.forEach((child) => {
          total++;
          const val = child.val();
          if (val.status === "ØµØ­ÙŠØ­") valid++; else invalid++;
      });
      animateValue("total-votes", parseInt(document.getElementById("total-votes").innerText), total, 500);
      animateValue("valid-votes", parseInt(document.getElementById("valid-votes").innerText), valid, 500);
      animateValue("invalid-votes", parseInt(document.getElementById("invalid-votes").innerText), invalid, 500);
  });

  function animateValue(id, start, end, duration) {
      if (start === end) return;
      const obj = document.getElementById(id);
      let startTimestamp = null;
      const step = (timestamp) => {
          if (!startTimestamp) startTimestamp = timestamp;
          const progress = Math.min((timestamp - startTimestamp) / duration, 1);
          obj.innerHTML = Math.floor(progress * (end - start) + start);
          if (progress < 1) window.requestAnimationFrame(step); else obj.innerHTML = end;
      };
      window.requestAnimationFrame(step);
  }

  window.fillMsg = function(text) { 
      const input = document.getElementById("msg-input"); input.value = text; input.focus();
  }
  
  document.getElementById("send-btn").addEventListener("click", () => {
    const input = document.getElementById("msg-input");
    if (!input.value.trim()) return;
    set(ref(db, 'broadcast_message'), { text: input.value.trim(), timestamp: Date.now() });
    input.value = "";
    const status = document.getElementById("status-msg");
    status.style.display = "block"; status.style.animation = "fadeInUp 0.5s ease";
    setTimeout(()=> { status.style.display="none"; }, 3000);
  });

  const votesRef = query(ref(db, 'votes'), limitToLast(50));
  const logBody = document.getElementById("log-body");

  onChildAdded(votesRef, (snapshot) => {
      const data = snapshot.val();
      if(!data) return;
      const row = document.createElement("tr");
      row.className = "log-row";
      const timeStr = new Date(data.timestamp).toLocaleTimeString('ar-EG');
      const statusClass = data.status === "ØµØ­ÙŠØ­" ? "status-valid" : "status-invalid";
      let candidatesHtml = "";
      if(data.candidates && Array.isArray(data.candidates)){
          data.candidates.forEach(c => { candidatesHtml += `<span class="candidate-pill">${c}</span>`; });
      } else { candidatesHtml = "<span style='opacity:0.5'>--</span>"; }
      
      row.innerHTML = `<td><div style="font-weight:bold; color:#fff;">${data.name}</div><div style="font-size:0.75em; color:#aaa;">ğŸ•’ ${timeStr}</div></td><td>${candidatesHtml}</td><td><span class="status-badge ${statusClass}">${data.status}</span></td>`;
      logBody.prepend(row);
  });
</script>
</body>
</html>
