<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<title>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Cairo", "Segoe UI", Tahoma, sans-serif;
}

body {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  padding: 20px;
  color: #fff;
  overflow-x: hidden;
}

.hidden {
  display: none !important;
}

/* Password Modal */
#password-modal {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(10px);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 9999;
}

.pass-box {
  width: 95%;
  max-width: 400px;
  background: #fff;
  color: #222;
  padding: 35px 18px;
  border-radius: 18px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
  animation: pop 0.4s ease;
  text-align: center;
}

@keyframes pop {
  from {
    transform: scale(0.6);
    opacity: 0.2;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.pass-title {
  font-size: 1.6em;
  font-weight: 900;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.pass-row {
  position: relative;
  margin-top: 20px;
}

.pass-input {
  width: 100%;
  padding: 14px 16px;
  text-align: center;
  border-radius: 12px;
  border: 2px solid #e0e7ff;
  background: #f8f9ff;
  font-size: 1.1em;
  transition: all 0.3s;
}

.pass-input:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

.pass-toggle {
  position: absolute;
  left: 15px;
  top: 52%;
  transform: translateY(-50%);
  font-size: 1.3em;
  color: #667eea;
  cursor: pointer;
  opacity: 0.6;
  transition: all 0.3s;
}

.pass-toggle:hover {
  opacity: 1;
}

.pass-btn {
  margin-top: 20px;
  width: 100%;
  padding: 13px;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 1.05em;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
}

.pass-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.pass-err {
  margin-top: 12px;
  padding: 10px;
  border-radius: 8px;
  font-weight: bold;
  display: none;
  font-size: 0.95em;
  background: #ffebee;
  color: #c62828;
}

/* Logout Button */
.logout-btn {
  position: fixed;
  top: 20px;
  left: 20px;
  z-index: 1000;
  background: linear-gradient(135deg, #ff6b6b 0%, #c62828 100%);
  color: #fff;
  border: none;
  padding: 14px 26px;
  border-radius: 12px;
  font-weight: 700;
  font-size: 1.07em;
  cursor: pointer;
  transition: all 0.3s;
  box-shadow: 0 4px 12px rgba(198, 40, 40, 0.3);
}

.logout-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(198, 40, 40, 0.4);
}

.remote-logout-btn {
  width: 100%;
  margin-top: 15px;
  padding: 12px;
  background: #ffc107;
  color: #333;
  font-weight: bold;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  transition: background 0.3s;
}

.remote-logout-btn:hover {
  background: #ff9800;
}

/* Active Committees List */
.active-committee-item {
  background: #fff;
  border: 2px solid #4caf50;
  padding: 12px;
  border-radius: 10px;
  margin-bottom: 10px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s;
  border-left: 5px solid #4caf50;
}

.active-committee-item:hover {
  box-shadow: 0 4px 12px rgba(76, 175, 80, 0.3);
  transform: translateX(-3px);
}

.committee-info-text {
  flex: 1;
}

.committee-number {
  font-size: 1.2em;
  font-weight: 900;
  color: #4caf50;
  margin-bottom: 3px;
}

.committee-details {
  font-size: 0.9em;
  color: #666;
}

.kick-btn {
  background: linear-gradient(135deg, #ff6b6b 0%, #c62828 100%);
  color: #fff;
  border: none;
  padding: 10px 20px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: all 0.3s;
  font-size: 0.95em;
}

.kick-btn:hover {
  transform: scale(1.05);
  box-shadow: 0 4px 12px rgba(198, 40, 40, 0.4);
}

.no-active-committees {
  text-align: center;
  padding: 20px;
  color: #999;
  font-style: italic;
}

/* Main Container */
.container {
  width: 100%;
  max-width: 420px;
  background: #fff;
  color: #222;
  padding: 26px;
  border-radius: 20px;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
  animation: fade 0.5s ease;
}

@keyframes fade {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

h2 {
  text-align: center;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-size: 2em;
  font-weight: 900;
  margin-bottom: 10px;
}

.committee-info {
  text-align: center;
  margin-top: 12px;
  margin-bottom: 25px;
  background: linear-gradient(135deg, #f5f7ff 0%, #eff2ff 100%);
  padding: 12px;
  border-radius: 12px;
  border-left: 4px solid #667eea;
}

.committee-name {
  font-size: 1.06em;
  font-weight: 700;
  color: #667eea;
  margin-bottom: 4px;
}

.committee-address {
  font-size: 0.88em;
  color: #666;
  font-weight: 500;
}

/* Form Elements */
label {
  font-weight: 700;
  color: #333;
  margin-top: 16px;
  display: block;
}

input[type="text"] {
  width: 100%;
  padding: 13px 12px;
  border-radius: 12px;
  border: 2px solid #e0e7ff;
  background: #f8f9ff;
  font-size: 1em;
  transition: all 0.3s;
  margin-top: 8px;
}

input[type="text"]:focus {
  outline: none;
  border-color: #667eea;
  box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
}

/* Candidate List */
.candidate-list {
  margin-top: 10px;
  background: #f8f9ff;
  border: 2px solid #e0e7ff;
  border-radius: 14px;
  max-height: 320px;
  overflow-y: auto;
  padding: 8px;
}

.candidate-item {
  background: #fff;
  border: 1px solid #e8ecff;
  padding: 10px;
  border-radius: 12px;
  margin-bottom: 9px;
  display: flex;
  justify-content: space-between;
  align-items: center;
  transition: all 0.3s;
  cursor: pointer;
  border-left: 4px solid #667eea;
  min-height: 47px;
}

.candidate-item:hover {
  background: linear-gradient(135deg, #f5f7ff 0%, #eff2ff 100%);
  border-color: #667eea;
  box-shadow: 0 4px 12px rgba(102, 126, 234, 0.17);
}

.candidate-item.selected {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
  border-left-color: #fff;
}

.c-left {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
}

.num-circle {
  width: 32px;
  height: 32px;
  border-radius: 50%;
  background: #667eea;
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 0.97em;
  font-weight: 900;
}

.candidate-item.selected .num-circle {
  background: #fff;
  color: #667eea;
}

.c-name {
  font-weight: 700;
  word-break: break-word;
}

.c-right {
  display: flex;
  align-items: center;
  gap: 10px;
}

.c-icon {
  font-size: 1.5em;
}

input[type="checkbox"] {
  width: 22px;
  height: 22px;
  cursor: pointer;
  accent-color: #667eea;
}

/* Radio Section */
.sec-box {
  margin-top: 13px;
  background: linear-gradient(135deg, #f5f7ff 0%, #eff2ff 100%);
  border: 2px solid #e0e7ff;
  border-radius: 12px;
  padding: 12px;
}

.sec-title {
  font-weight: 700;
  color: #667eea;
  display: block;
  margin-bottom: 12px;
  font-size: 1em;
}

.radio-group {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}

.radio-item {
  display: flex;
  align-items: center;
  gap: 8px;
  cursor: pointer;
  padding: 8px;
  background: #fff;
  border-radius: 10px;
  border: 2px solid #e0e7ff;
  transition: all 0.3s;
}

.radio-item:hover {
  border-color: #667eea;
  background: #f8f9ff;
}

.radio-item input[type="radio"] {
  width: 18px;
  height: 18px;
  cursor: pointer;
  accent-color: #667eea;
}

.radio-item.selected {
  background: #667eea;
  color: #fff;
  border-color: #667eea;
}

/* Buttons */
.btn-row {
  display: flex;
  gap: 10px;
  margin-top: 23px;
}

button {
  flex: 1;
  padding: 13px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  font-weight: 700;
  font-size: 1.03em;
  transition: all 0.3s;
}

.btn-primary {
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  color: #fff;
}

.btn-primary:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-reset {
  background: #e0e7ff;
  color: #667eea;
  font-weight: 700;
}

.btn-reset:hover {
  background: #d3ddff;
}

/* Upload Button */
.action-btn {
  width: 100%;
  margin-top: 15px;
  padding: 13px;
  background: linear-gradient(135deg, #4c28d3 0%, #7d45ff 100%);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 1.03em;
  font-weight: 700;
  cursor: pointer;
  transition: all 0.3s;
}

.action-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(76, 40, 211, 0.4);
}

/* Messages */
.msg-warn,
.msg-confirm {
  display: none;
  margin-top: 12px;
  padding: 11px;
  border-radius: 10px;
  text-align: center;
  font-weight: 700;
  animation: slideDown 0.3s ease;
  font-size: 1em;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.msg-warn {
  background: #ffebee;
  color: #c62828;
  border-left: 4px solid #c62828;
}

.msg-confirm {
  background: #e8f5e9;
  color: #2e7d32;
  border-left: 4px solid #2e7d32;
}

/* Notification Bubble */
#bubble {
  position: fixed;
  bottom: 13px;
  right: 13px;
  background: #fff;
  color: #222;
  padding: 16px;
  border-radius: 12px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.25);
  font-size: 1em;
  font-weight: 700;
  display: none;
  width: 320px;
  max-width: calc(100vw - 26px);
  animation: slide 0.4s ease;
  border-left: 4px solid #667eea;
  z-index: 99999;
}

#bubble.active {
  display: flex;
  align-items: flex-start;
  gap: 10px;
}

#bubble-icon {
  font-size: 1.3em;
  min-width: 28px;
  text-align: center;
  margin-top: 2px;
}

#bubble-content {
  flex: 1;
  line-height: 1.55;
}

#bubble-close {
  background: none;
  border: none;
  font-size: 1.4em;
  color: #999;
  cursor: pointer;
  padding: 0;
  min-width: 28px;
  text-align: center;
  transition: all 0.3s;
  opacity: 0.6;
}

#bubble-close:hover {
  opacity: 1;
  color: #667eea;
}

@keyframes slide {
  from {
    transform: translateY(18px);
    opacity: 0;
  }
  to {
    transform: translateY(0);
    opacity: 1;
  }
}

/* Signature */
.sig {
  text-align: left;
  margin-top: 17px;
  color: #999;
  font-style: italic;
  font-size: 0.82em;
}

.sig a {
  color: #1e3c72;
  font-weight: 900;
  text-decoration: underline;
}

/* Responsive */
@media (max-width: 600px) {
  .container {
    max-width: 98vw;
    padding: 5vw;
    border-radius: 8px;
  }

  h2 {
    font-size: 1.5em;
  }

  .radio-group {
    grid-template-columns: 1fr;
  }

  .candidate-list {
    max-height: 340px;
  }

  .logout-btn {
    top: 7px;
    left: 6px;
    padding: 9px 13px;
    font-size: 0.95em;
    border-radius: 9px;
  }

  #bubble {
    max-width: calc(100vw - 30px);
    right: 10px;
    padding: 12px;
    font-size: 0.95em;
  }

  #bubble-close {
    position: absolute;
    right: 5px;
    top: 5px;
  }
}
</style>
</head>
<body>
<button class="logout-btn hidden" id="logout-btn" onclick="logoutCommittee()">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>

<div id="bubble">
  <div id="bubble-icon">ğŸ’¬</div>
  <div id="bubble-content"></div>
  <button id="bubble-close" onclick="closeBubble()">Ã—</button>
</div>

<div id="password-modal">
  <div class="pass-box">
    <div class="pass-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</div>
    <div class="pass-row">
      <input type="password" id="password-input" class="pass-input" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±" autocomplete="off">
      <span class="pass-toggle" onclick="togglePass()">ğŸ‘</span>
    </div>
    <button class="pass-btn" onclick="checkPass()">Ø¯Ø®ÙˆÙ„</button>
    <div id="pw-err" class="pass-err">ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©</div>
  </div>
</div>

<div class="container hidden" id="main-container">
  <h2 id="welcome-title">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</h2>
  <div class="committee-info">
    <div class="committee-name" id="committee-name-display"></div>
    <div class="committee-address" id="committee-address-display"></div>
  </div>
  
  <button class="remote-logout-btn hidden" id="remote-logout-btn" onclick="remoteLogout()">Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ</button>
  
  <!-- Active Committees Panel for Super Admin -->
  <div id="active-committees-panel" class="hidden" style="margin-top: 20px;">
    <div class="sec-box">
      <span class="sec-title">Ø§Ù„Ù„Ø¬Ø§Ù† Ø§Ù„Ù†Ø´Ø·Ø© Ø§Ù„Ù…Ø³Ø¬Ù„Ø© Ø­Ø§Ù„ÙŠØ§Ù‹ ğŸŸ¢</span>
      <div id="active-committees-list" style="margin-top: 15px;"></div>
    </div>
  </div>
  
  <!-- Admin Panel -->
  <form id="vote-form">
    <label>Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨:</label>
    <input type="text" id="voter-name" placeholder="Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù†Ø§Ø®Ø¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)">
    
    <label>Ø§Ø®ØªØ± Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ø«Ù†ÙŠÙ† (Ø¥Ø¬Ø¨Ø§Ø±ÙŠ):</label>
    <div class="candidate-list" id="candidate-list"></div>
    
    <div class="sec-box">
      <span class="sec-title">Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª:</span>
      <div class="radio-group">
        <label class="radio-item">
          <input type="radio" name="vvalid" value="ØµØ­ÙŠØ­">
          <span>âœ“ ØµØ­ÙŠØ­</span>
        </label>
        <label class="radio-item">
          <input type="radio" name="vvalid" value="Ø¨Ø§Ø·Ù„">
          <span>âœ— Ø¨Ø§Ø·Ù„</span>
        </label>
      </div>
    </div>
    
    <div class="btn-row">
      <button type="submit" class="btn-primary">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„ØªØµÙˆÙŠØª</button>
      <button type="reset" class="btn-reset">Ø¥Ø¹Ø§Ø¯Ø© Ø¶Ø¨Ø·</button>
    </div>
    
    <div id="msg-warn" class="msg-warn"></div>
    <div id="msg-confirm" class="msg-confirm"></div>
  </form>

  <button id="openUpload" class="action-btn">Ø±ÙØ¹ Ù…Ø­Ø¶Ø± Ø§Ù„Ù„Ø¬Ù†Ø© ğŸ“„</button>
  <input type="file" id="uploadFile" accept="image/*" style="display:none">

  <div class="sig">
    ØªÙ… Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© Ø¨ÙˆØ§Ø³Ø·Ø©
    <a href="https://www.facebook.com/en.mohamed.nasr" target="_blank">Ø§Ù„Ù…Ù‡Ù†Ø¯Ø³ Ù…Ø­Ù…Ø¯ Ø­Ù…Ø§Ø¯</a>
  </div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import { getDatabase, ref, set, onValue, onDisconnect, get, serverTimestamp, remove } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyCxxXV_6CEo1fTp3rRbfwfYbe7WH0Cyg38",
  authDomain: "elahmadiya.firebaseapp.com",
  databaseURL: "https://elahmadiya-default-rtdb.firebaseio.com",
  projectId: "elahmadiya",
  storageBucket: "elahmadiya.firebasestorage.app",
  messagingSenderId: "594580767620",
  appId: "1:594580767620:web:f5be3b87d4c704854e53d1"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

let committeeNumber = 0;
let closedNotifications = new Set();
let myPresenceRef = null;
let isAdmin = false;

const imgbbKey = "4580317b11de33e7c7630672bfc20bf9";

// Upload Handler
document.getElementById("openUpload").addEventListener("click", () => {
  document.getElementById("uploadFile").click();
});

document.getElementById("uploadFile").addEventListener("change", function () {
  const file = this.files[0];
  if (!file) return;

  const formData = new FormData();
  formData.append("image", file);

  document.getElementById("openUpload").innerText = "Ø¬Ø§Ø±ÙŠ Ø±ÙØ¹ Ø§Ù„Ù…Ø­Ø¶Ø±... â³";

  fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
    method: "POST",
    body: formData
  })
  .then(res => res.json())
  .then(data => {
    if (data.success) {
      const url = data.data.url;
      showConfirm("âœ… ØªÙ… Ø±ÙØ¹ ØµÙˆØ±Ø© Ø§Ù„Ù…Ø­Ø¶Ø± Ø¨Ù†Ø¬Ø§Ø­!");
      console.log("Image URL:", url);
      document.getElementById("openUpload").innerText = "âœ” ØªÙ… Ø§Ù„Ø±ÙØ¹";
      document.getElementById("openUpload").style.background = "#28a745";
    } else {
      showWarn("âŒ ÙØ´Ù„ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
      document.getElementById("openUpload").innerText = "Ø±ÙØ¹ Ù…Ø­Ø¶Ø± Ø§Ù„Ù„Ø¬Ù†Ø© ğŸ“„";
    }
  })
  .catch(err => {
    console.error(err);
    showWarn("âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©");
    document.getElementById("openUpload").innerText = "Ø±ÙØ¹ Ù…Ø­Ø¶Ø± Ø§Ù„Ù„Ø¬Ù†Ø© ğŸ“„";
  });
});

function loadClosedNotifications() {
  const stored = localStorage.getItem("closedNotifications");
  if (stored) {
    try {
      closedNotifications = new Set(JSON.parse(stored));
    } catch (e) {
      closedNotifications = new Set();
    }
  }
}

function saveClosedNotifications() {
  try {
    localStorage.setItem("closedNotifications", JSON.stringify(Array.from(closedNotifications)));
  } catch (e) {}
}

loadClosedNotifications();

const committeeData = {
  1: {name: "Ø§Ù„ÙØ±ÙˆØ³Ø§Øª", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ø­Ù…Ø¯ Ø§Ù„Ù‚ØµØ¨Ù‰ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  2: {name: "Ø§Ù„ÙØ±ÙˆØ³Ø§Øª", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ø­Ù…Ø¯ Ø§Ù„Ù‚ØµØ¨Ù‰ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  3: {name: "Ø£Ø¨Ùˆ Ø§Ù„Ø£Ø®Ø¶Ø±", address: "Ù…Ø¯Ø±Ø³Ø© Ø£Ø¨Ùˆ Ø§Ù„Ø£Ø®Ø¶Ø± Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  4: {name: "Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…Ø¯ ÙÙˆØ²Ù‰"},
  5: {name: "Ø§Ù„Ø¹Ø§Ù…Ø±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¹Ø§Ù…Ø±Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  6: {name: "Ø¬Ø¯ÙŠØ¯Ø© Ø§Ù„Ù…Ù†Ø²Ù„Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø¨Ø¯Ù‡ Ø¨Ø·ÙŠ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  7: {name: "Ø¹Ø±Ø¨ Ø²ÙŠØ¯Ø§Ù†", address: "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø±Ø¨ Ø²ÙŠØ¯Ø§Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  8: {name: "Ø§Ù„Ø³ØªØ§ÙŠØªØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø²ØºÙ„ÙˆÙ„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  9: {name: "ÙƒÙØ± Ø­Ø¬Ø§Ø¬", address: "Ù…Ø¯Ø±Ø³Ø© ÙƒÙØ± Ø­Ø¬Ø§Ø¬ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  10: {name: "Ù…ÙŠØª Ø®Ø¶", address: "Ù…Ø¯Ø±Ø³Ø© Ù…Ø­Ù…Ø¯ Ø¥Ø³Ù…Ø§Ø¹ÙŠÙ„ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  11: {name: "Ø§Ù„Ù…ÙˆØ§Ø¬Ø¯Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø­Ø³Ù†ÙŠ Ø§Ù„Ø´Ù†Ø§ÙˆÙ‰"},
  12: {name: "Ø§Ù„Ø¨Ø¶Ø§Ø·", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§ÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  13: {name: "Ø§Ù„Ø¨Ø¶Ø§Ø·", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…Ø¯ Ø§Ù„Ù…Ø­Ù„Ø§ÙˆÙ‰ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  14: {name: "Ø§Ù„Ø·ÙˆØ§Ø¨Ø±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†ØµØ± Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  15: {name: "Ø§Ù„Ø¹Ù…Ø§Ø±Ù†Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¹Ù…Ø§Ø±Ù†Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  16: {name: "Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ù†Ø§", address: "Ù…Ø¯Ø±Ø³Ø© Ø£ÙˆÙ„Ø§Ø¯ Ø¨Ø§Ù†Ø§ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  17: {name: "Ø£ÙˆÙ„Ø§Ø¯ Ø­Ø§Ù†Ø§", address: "Ù…Ø¯Ø±Ø³Ø© Ø£ÙˆÙ„Ø§Ø¯ Ø­Ø§Ù†Ø§ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  18: {name: "Ø§Ù„Ù‚Ø²Ø§Ù‚Ø²Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù‚Ø²Ø§Ù‚Ø²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  19: {name: "Ø§Ù„Ø­ÙˆØªÙ‡", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ø§Ø³Ù„Ø§Ù… Ù…Ø­Ù…Ø¯"},
  20: {name: "Ø£ÙˆÙ„Ø§Ø¯ Ù†ÙˆØ±", address: "Ù…Ø¯Ø±Ø³Ø© Ø£ÙˆÙ„Ø§Ø¯ Ù†ÙˆØ± Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  21: {name: "Ø§Ù„Ø®Ù„Ø§ÙŠÙØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…ÙˆØ¯ ÙÙ‡ÙŠÙ… Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  22: {name: "Ø§Ù„Ù‚Ø·Ø´Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù‚Ø·Ø´Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  23: {name: "Ø§Ù„Ø¬Ù…Ø§Ù…Ù„Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¬Ù…Ø§Ù…Ù„Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  24: {name: "Ø§Ù„Ø¹Ø²ÙŠØ²Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  25: {name: "Ø§Ù„Ø¹Ø²ÙŠØ²Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ù…Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ø²ÙŠØ²Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  26: {name: "Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ø­Ù…Ø¯ÙŠØ© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  27: {name: "Ø§Ù„Ø¹Ø±Ø¨Ø§Ù†", address: "Ù…Ø¯Ø±Ø³Ø© Ø·Ø§Ù‡Ø± ÙØ±Ø­"},
  28: {name: "Ø£ÙˆÙ„Ø§Ø¯ Ø¹Ù„Ù…", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù†ÙŠ Ø³Ù„ÙŠÙ… Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  29: {name: "Ø£ÙˆÙ„Ø§Ø¯ Ù†Ø§ØµØ±", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¯ÙƒØªÙˆØ± Ù…Ø­Ù…Ø¯ Ø§Ù„Ù†Ø­Ø§Ø³"},
  30: {name: "Ø¨Ø¨Ø± Ù‡Ù„Ø§Ù„", address: "Ù…Ø¯Ø±Ø³Ø© Ø¨Ø¨Ø± Ù‡Ù„Ø§Ù„ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  31: {name: "Ø§Ù„Ø´Ø¨ÙˆÙ„", address: "Ù…Ø¹Ù‡Ø¯ Ø¨Ù†ÙŠ Ø§Ù„Ø´Ø¨ÙˆÙ„ Ø§Ù„Ø£Ø²Ù‡Ø±Ù‰"},
  32: {name: "Ø§Ù„Ø´Ø¨ÙˆÙ„", address: "Ù…Ø¹Ù‡Ø¯ Ø¨Ù†ÙŠ Ø§Ù„Ø´Ø¨ÙˆÙ„ Ø§Ù„Ø£Ø²Ù‡Ø±Ù‰"},
  33: {name: "Ø§Ù„Ø±ÙˆØ¯Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø±ÙˆØ¯Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  34: {name: "Ù…ÙŠØª Ø´Ø±ÙŠÙ", address: "Ù…Ø¯Ø±Ø³Ø© Ø£Ù… Ø§Ù„Ù…Ø¤Ù…Ù†ÙŠÙ† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  35: {name: "Ø¨Ø­Ø± Ø­Ø§Ø¯ÙˆØ«", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø³ÙŠØ¯ Ù‚Ø·Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  36: {name: "Ø§Ù„Ù†Ø³Ø§ÙŠÙ…Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ø³Ø§ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  37: {name: "Ø§Ù„Ù†Ø³Ø§ÙŠÙ…Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù†Ø³Ø§ÙŠÙ…Ø© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  38: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø«ÙˆØ±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ù†Ø¬Ø¯ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ù†Ø§Øª"},
  39: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø«ÙˆØ±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø´Ù‡ÙŠØ¯ Ù…Ø­Ù…ÙˆØ¯ Ø§Ù„Ù†Ø¬Ø¯ÙŠ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ù†Ø§Øª"},
  40: {name: "Ø´Ø§Ø±Ø¹ Ù…Ø­Ù…Ø¯ ÙØ±ÙŠØ¯", address: "Ù…Ø¹Ù‡Ø¯ ÙØªÙŠØ§Øª Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ø¹ Ø«"},
  41: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…ÙŠÙ†Ø§ Ø§Ù„Ù‚Ø¨Ù„ÙŠ", address: "Ù…Ø¯Ø±Ø³Ø© Ø£Ø¨Ùˆ Ø¨ÙƒØ± Ø§Ù„ØµØ¯ÙŠÙ‚"},
  42: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø£Ø­Ù…Ø¯ Ù…Ø§Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ù†ÙŠÙ†"},
  43: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø£Ø­Ù…Ø¯ Ù…Ø§Ù‡Ø± Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ù†ÙŠÙ†"},
  44: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…ÙŠÙ†Ø§ Ø§Ù„Ø¨Ø­Ø±ÙŠ", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¹Ø§Ø´Ø± Ù…Ù† Ø±Ù…Ø¶Ø§Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  45: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…ÙŠÙ†Ø§ Ø§Ù„Ø¨Ø­Ø±ÙŠ", address: "Ù…Ø¯Ø±Ø³Ø© Ø·Ø§Ø±Ù‚ Ø§Ø¨Ù† Ø²ÙŠØ§Ø¯ Ø§Ù„Ø£Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  46: {name: "Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹ØµØ§ÙØ±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ù†ÙØ³ÙŠØ© Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø¨Ù†Ø§Øª"},
  47: {name: "Ù‚Ø±ÙŠØ© Ø§Ù„Ø¹ØµØ§ÙØ±Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø³ÙŠØ¯Ø© Ù†ÙØ³ÙŠØ© Ø§Ù„Ø§Ø¹Ø¯Ø§Ø¯ÙŠØ© Ø¨Ù†Ø§Øª"},
  48: {name: "Ù‚Ø±ÙŠØ© Ø§Ù„Ø¶Ù‡ÙŠØ±", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø¶Ù‡ÙŠØ± Ø§Ù„Ø¥Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  49: {name: "Ø´Ø§Ø±Ø¹ ØµÙ„Ø§Ø­ Ø§Ù„Ø¯ÙŠÙ†", address: "Ù…Ø¹Ù‡Ø¯ Ø¹Ø«Ù…Ø§Ù† Ø¨Ù† Ø¹ÙØ§Ù† Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠ"},
  50: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø§Ù„ÙˆÙ„ÙŠØ¯"},
  51: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø¯Ù‚Ù‡Ù„ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø®Ø§Ù„Ø¯ Ø¨Ù† Ø§Ù„ÙˆÙ„ÙŠØ¯"},
  52: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ù…ÙŠÙ†Ø§ Ø§Ù„Ø¨Ø­Ø±ÙŠ", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ù…Ø·Ø±ÙŠØ© Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  53: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø¨Ù†ÙŠÙ†"},
  54: {name: "Ø´Ø§Ø±Ø¹ Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„", address: "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø«Ù…Ø§Ù† Ø¨Ù† Ø¹ÙØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  55: {name: "Ø´Ø§Ø±Ø¹ Ù…ØµÙ†Ø¹ Ø§Ù„Ø¨ØµÙ„", address: "Ù…Ø¯Ø±Ø³Ø© Ø¹Ø«Ù…Ø§Ù† Ø¨Ù† Ø¹ÙØ§Ù† Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ÙŠØ©"},
  56: {name: "Ø´Ø§Ø±Ø¹ Ø¨ÙˆØ±Ø³Ø¹ÙŠØ¯", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ù†ØµØ§Ø±ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  57: {name: "Ù‡Ø§Ø´Ù… Ø´Ù„Ø¨Ø§ÙŠØ©", address: "Ù…Ø¯Ø±Ø³Ø© Ù‡Ø§Ø´Ù… Ø´Ù„Ø¨Ø§ÙŠØ© Ø®Ù„Ù Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰"},
  58: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  59: {name: "Ø´Ø§Ø±Ø¹ Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø²Ù‡Ø±Ø§Ø¡ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"},
  60: {name: "Ø³ÙˆÙ‚ Ø§Ù„Ø¬Ù…Ø¹Ø©", address: "Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø§Ù…Ø§Ù… Ø¹Ù„ÙŠ Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ©"}
};

window.togglePass = function() {
  const p = document.getElementById("password-input");
  p.type = (p.type === "password") ? "text" : "password";
};

async function tryCommitteeLogin(committee, info) {
  const presenceRef = ref(db, `presence/committee_${committee}`);
  const remoteLogoutBtn = document.getElementById("remote-logout-btn");
  
  try {
    const snapshot = await get(presenceRef);
    if (snapshot.exists()) {
      if (isAdmin) {
        remoteLogoutBtn.classList.remove("hidden");
      } else {
        const err = document.getElementById("pw-err");
        err.textContent = "âš ï¸ ÙŠÙˆØ¬Ø¯ Ù…Ù†Ø¯ÙˆØ¨ Ø¢Ø®Ø± ÙØ§ØªØ­ Ù‡Ø°Ù‡ Ø§Ù„Ù„Ø¬Ù†Ø©";
        err.style.background = "#fff3cd";
        err.style.color = "#856404";
        err.style.display = "block";
        setTimeout(() => err.style.display = "none", 3500);
        return false;
      }
    } else {
      remoteLogoutBtn.classList.add("hidden");
    }

    if (!isAdmin) {
      committeeNumber = committee;
      myPresenceRef = presenceRef;
      
      await set(presenceRef, {
        online: true,
        loginTime: serverTimestamp(),
        committee: committee
      });
      
      const connectedRef = ref(db, '.info/connected');
      onValue(connectedRef, async (snap) => {
        if (snap.val() === true) {
          await onDisconnect(presenceRef).remove();
        }
      });
      
      let isInitialLoad = true;
      onValue(presenceRef, (snapshot) => {
        if (isInitialLoad) {
          isInitialLoad = false;
          return;
        }
        
        if (!snapshot.exists() && myPresenceRef) {
          alert("âš ï¸ ØªÙ… Ø¥Ø®Ø±Ø§Ø¬Ùƒ Ù…Ù† Ù‚Ø¨Ù„ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù…");
          myPresenceRef = null;
          location.reload();
        }
      });
    } else {
      committeeNumber = committee;
      myPresenceRef = null;
    }

    document.getElementById("password-modal").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("logout-btn").classList.remove("hidden");
    document.getElementById("welcome-title").textContent = (isAdmin ? "Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù„Ø¬Ù†Ø© " : "Ø§Ù„Ù„Ø¬Ù†Ø© ") + committee;
    document.getElementById("committee-name-display").textContent = info.name;
    document.getElementById("committee-address-display").textContent = info.address;
    
    if (isAdmin) {
      document.getElementById("vote-form").style.display = 'none';
      document.getElementById("openUpload").style.display = 'none';
      document.getElementById("active-committees-panel").classList.add("hidden");
    } else {
      document.getElementById("vote-form").style.display = 'block';
      document.getElementById("openUpload").style.display = 'block';
    }
    
    setupNotificationListeners(committee);
    return true;
  } catch (error) {
    const err = document.getElementById("pw-err");
    err.textContent = "Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„";
    err.style.display = "block";
    setTimeout(() => err.style.display = "none", 2000);
    return false;
  }
}

window.remoteLogout = async function() {
  if (!isAdmin || committeeNumber < 1 || committeeNumber > 60) {
    alert("Ø®Ø·Ø£: Ù„Ø§ ØªÙ…Ù„Ùƒ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¬Ø±Ø§Ø¡ Ù‡Ø°Ù‡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©.");
    return;
  }
  
  const confirmLogout = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù„Ø¬Ù†Ø© ${committeeNumber}ØŸ`);
  if (!confirmLogout) return;
  
  const presenceRef = ref(db, `presence/committee_${committeeNumber}`);
  try {
    await remove(presenceRef);
    document.getElementById("remote-logout-btn").classList.add("hidden");
    showConfirm(`ØªÙ… Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù Ù…Ù† Ø§Ù„Ù„Ø¬Ù†Ø© ${committeeNumber} Ø¨Ù†Ø¬Ø§Ø­!`);
  } catch (error) {
    showWarn("ÙØ´Ù„ ÙÙŠ Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù.");
  }
};

async function loadActiveCommittees() {
  const presenceBaseRef = ref(db, 'presence');
  onValue(presenceBaseRef, (snapshot) => {
    const data = snapshot.val();
    const listContainer = document.getElementById("active-committees-list");
    listContainer.innerHTML = "";
    
    if (!data || Object.keys(data).length === 0) {
      listContainer.innerHTML = '<div class="no-active-committees">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø¬Ø§Ù† Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
      return;
    }
    
    Object.entries(data).forEach(([key, value]) => {
      const match = key.match(/committee_(\d+)/);
      if (match && value.online) {
        const committeeNum = parseInt(match[1]);
        const info = committeeData[committeeNum] || { name: "Ù„Ø¬Ù†Ø©", address: "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" };
        
        const item = document.createElement("div");
        item.className = "active-committee-item";
        item.innerHTML = `
          <div class="committee-info-text">
            <div class="committee-number">ğŸŸ¢ Ø§Ù„Ù„Ø¬Ù†Ø© ${committeeNum}</div>
            <div class="committee-details">${info.name} - ${info.address}</div>
          </div>
          <button class="kick-btn" onclick="kickCommittee(${committeeNum})">ØªØ³Ø¬ÙŠÙ„ Ø®Ø±ÙˆØ¬</button>
        `;
        listContainer.appendChild(item);
      }
    });
    
    if (listContainer.children.length === 0) {
      listContainer.innerHTML = '<div class="no-active-committees">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù„Ø¬Ø§Ù† Ù†Ø´Ø·Ø© Ø­Ø§Ù„ÙŠØ§Ù‹</div>';
    }
  });
}

window.kickCommittee = async function(committeeNum) {
  const confirmLogout = confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù Ù…Ù† Ø§Ù„Ù„Ø¬Ù†Ø© ${committeeNum}ØŸ\n\nØ³ÙŠØªÙ… Ø¥Ø¬Ø¨Ø§Ø± Ø§Ù„Ù…Ø´Ø±Ù Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙÙˆØ±Ø§Ù‹.`);
  if (!confirmLogout) return;
  
  const presenceRef = ref(db, `presence/committee_${committeeNum}`);
  try {
    await remove(presenceRef);
    showConfirm(`âœ… ØªÙ… Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù Ù…Ù† Ø§Ù„Ù„Ø¬Ù†Ø© ${committeeNum} Ø¨Ù†Ø¬Ø§Ø­!`);
  } catch (error) {
    showWarn("âŒ ÙØ´Ù„ ÙÙŠ Ø¥Ø®Ø±Ø§Ø¬ Ø§Ù„Ù…Ø´Ø±Ù. Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.");
  }
};

window.logoutCommittee = async function() {
  if (myPresenceRef && committeeNumber > 0 && !isAdmin) {
    try {
      await remove(myPresenceRef);
    } catch (error) {}
  }
  location.reload();
};

window.checkPass = async function() {
  const val = document.getElementById("password-input").value.trim();
  const err = document.getElementById("pw-err");
  const numVal = parseInt(val);
  const ADMIN_PREFIX = "251988";
  const MAX_COMMITTEE = 60;

  if (val === ADMIN_PREFIX) {
    isAdmin = true;
    document.getElementById("password-modal").classList.add("hidden");
    document.getElementById("main-container").classList.remove("hidden");
    document.getElementById("logout-btn").classList.remove("hidden");
    document.getElementById("welcome-title").textContent = "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ù€ Super Admin";
    document.getElementById("committee-name-display").textContent = "ÙˆØµÙˆÙ„ ØºÙŠØ± Ù…Ù‚ÙŠØ¯";
    document.getElementById("committee-address-display").textContent = "ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ø´Ø±Ù Ø¹Ø§Ù…";
    committeeNumber = 0;
    document.getElementById("remote-logout-btn").classList.add("hidden");
    document.getElementById("vote-form").style.display = 'none';
    document.getElementById("openUpload").style.display = 'none';
    document.getElementById("active-committees-panel").classList.remove("hidden");
    setupNotificationListeners(0);
    loadActiveCommittees();
    return;
  }

  if (val.startsWith(ADMIN_PREFIX) && val.length >= 7 && val.length <= 8) {
    const committeeStr = val.substring(ADMIN_PREFIX.length);
    const committee = parseInt(committeeStr);
    if (!isNaN(committee) && committee >= 1 && committee <= MAX_COMMITTEE) {
      const info = committeeData[committee] || { name: "Ù„Ø¬Ù†Ø©", address: "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" };
      isAdmin = true;
      await tryCommitteeLogin(committee, info);
      return;
    }
  }

  isAdmin = false;
  if (isNaN(numVal) || numVal < 100101 || numVal > 100160) {
    err.textContent = "ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± ØºÙŠØ± ØµØ­ÙŠØ­Ø©";
    err.style.display = "block";
    setTimeout(() => err.style.display = "none", 3000);
    return;
  }

  const committee = numVal - 100100;
  const info = committeeData[committee] || { name: "Ù„Ø¬Ù†Ø©", address: "Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†" };
  await tryCommitteeLogin(committee, info);
};

function setupNotificationListeners(committee) {
  try {
    const allNotificationsRef = ref(db, "notifications/all");
    let lastAllTimestamp = 0;
    onValue(allNotificationsRef, (snapshot) => {
      const data = snapshot.val();
      if (data && typeof data === 'object') {
        Object.entries(data).forEach(([key, notif]) => {
          if (notif && notif.message && notif.timestamp && notif.timestamp > lastAllTimestamp) {
            lastAllTimestamp = notif.timestamp;
            showFloatingNotification(notif.message, "Ø¹Ø§Ù…");
          }
        });
      }
    });

    if (committee >= 1 && committee <= 60 || committee === 0) {
      const committeeNotificationsRef = ref(db, "notifications/committee_" + committee);
      let lastCommitteeTimestamp = 0;
      onValue(committeeNotificationsRef, (snapshot) => {
        const data = snapshot.val();
        if (data && typeof data === 'object') {
          Object.entries(data).forEach(([key, notif]) => {
            if (notif && notif.message && notif.timestamp && notif.timestamp > lastCommitteeTimestamp) {
              lastCommitteeTimestamp = notif.timestamp;
              showFloatingNotification(notif.message, "Ù„Ø¬Ù†ØªÙƒ");
            }
          });
        }
      });
    }
  } catch (e) {}
}

function showFloatingNotification(msg, type) {
  const bubble = document.getElementById("bubble");
  const content = document.getElementById("bubble-content");
  const icon = document.getElementById("bubble-icon");
  const notificationId = type + "_" + Date.now();
  
  bubble.dataset.notificationId = notificationId;
  if (closedNotifications.has(notificationId)) return;
  
  content.textContent = msg;
  if (type === "Ø¹Ø§Ù…") {
    bubble.style.borderLeft = "4px solid #667eea";
    icon.textContent = "ğŸ“¢";
  } else if (type === "Ù„Ø¬Ù†ØªÙƒ") {
    bubble.style.borderLeft = "4px solid #11998e";
    icon.textContent = "ğŸ“©";
  } else {
    bubble.style.borderLeft = "4px solid #ffcc00";
    icon.textContent = "ğŸ’¬";
  }
  
  bubble.classList.add("active");
}

window.closeBubble = function() {
  const bubble = document.getElementById("bubble");
  const notificationId = bubble.dataset.notificationId;
  if (notificationId) {
    closedNotifications.add(notificationId);
    saveClosedNotifications();
  }
  bubble.classList.remove("active");
};

const candidates = [
  ["1", "Ø§ÙŠÙ‡Ø§Ø¨ Ø§Ù„Ø¹Ù…Ø¯Ù‡", "ğŸ‘‘"],
  ["2", "Ù…Ø­Ù…Ø¯ Ø§Ù„Ø¹ØªÙ…Ø§Ù†Ù‰", "ğŸ"],
  ["3", "Ø£Ø­Ù…Ø¯ Ø§Ù„Ø­Ø¯ÙŠØ¯Ù‰", "ğŸ¦"],
  ["4", "Ø¹Ø§Ø¯Ù„ Ø§Ù„Ø¬ÙŠØ§Ø±", "ğŸ¦…"],
  ["5", "Ø§Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ Ø³Ù…Ø±Ù‡", "ğŸ’£"],
  ["6", "ÙˆÙ„ÙŠØ¯ ØªÙŠØ³ÙŠØ± Ø§Ù„Ø§Ù…ÙŠØ±", "ğŸŠ"],
  ["7", "ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹ÙŠØ³ÙˆÙ‰", "ğŸŒ€"],
  ["8", "Ø§Ù„Ø¨Ø¯ÙˆÙ‰ Ø¬Ù…ÙŠØ²", "ğŸ‹"],
  ["9", "Ø§Ø­Ù…Ø¯ Ø§Ù„Ø±ÙŠØ³", "ğŸ¦‚"],
  ["10", "Ø£Ø­Ù…Ø¯ Ø¹ÙˆÙ", "âœ‹"],
  ["11", "Ø­Ø³Ù† Ø§Ù„Ù…Ù„Ù‡Ø§Ø·", "ğŸŒ¿"],
  ["12", "Ø¹Ù…Ø±Ùˆ Ù…Ø­Ù…Ø¯ Ø¨Ø­ÙŠØ±Ù‰", "ğŸšŒ"],
  ["13", "Ø§Ù„Ø³ÙŠØ¯ Ø·Ù…Ø§Ù†", "ğŸ”«"],
  ["14", "Ù…Ø­Ù…Ø¯ Ø¯Ù†Ø¯Ù†", "ğŸš"],
  ["15", "Ù…Ø¬Ø¯Ù‰ Ø§Ù„Ø£Ù…ÙŠØ±", "ğŸ–Š"]
];

const listBox = document.getElementById("candidate-list");
candidates.forEach((c) => {
  const item = document.createElement("div");
  item.className = "candidate-item";
  
  const checkbox = document.createElement("input");
  checkbox.type = "checkbox";
  checkbox.value = c[1];
  checkbox.className = "candidate-checkbox";
  
  item.innerHTML = '<div class="c-left"><div class="num-circle">' + c[0] + '</div><div class="c-name">' + c[1] + '</div></div><div class="c-right"><span class="c-icon">' + c[2] + '</span></div>';
  item.appendChild(checkbox);
  
  item.addEventListener("click", (e) => {
    if (e.target !== checkbox) checkbox.checked = !checkbox.checked;
    checkLimit();
    updateStyle();
  });
  
  checkbox.addEventListener("change", () => {
    checkLimit();
    updateStyle();
  });
  
  listBox.appendChild(item);
});

function updateStyle() {
  document.querySelectorAll(".candidate-item").forEach((item) => {
    if (item.querySelector("input[type='checkbox']").checked)
      item.classList.add("selected");
    else
      item.classList.remove("selected");
  });
}

function checkLimit() {
  const sel = document.querySelectorAll('.candidate-checkbox:checked');
  if (sel.length > 2) {
    sel[sel.length - 1].checked = false;
    showWarn("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ø«Ù†ÙŠÙ† ÙÙ‚Ø·");
    updateStyle();
  }
}

function showWarn(msg) {
  const el = document.getElementById("msg-warn");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 2500);
}

function showConfirm(msg) {
  const el = document.getElementById("msg-confirm");
  el.textContent = msg;
  el.style.display = "block";
  setTimeout(() => el.style.display = "none", 3000);
}

document.querySelectorAll("input[type='radio']").forEach(radio => {
  radio.addEventListener("change", function() {
    document.querySelectorAll(".radio-item").forEach(item => item.classList.remove("selected"));
    this.closest(".radio-item").classList.add("selected");
  });
});

document.getElementById("vote-form").addEventListener("submit", function(e) {
  e.preventDefault();
  
  if (committeeNumber === 0) return showWarn("Ù„Ø§ ÙŠÙ…ÙƒÙ† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ØµÙˆØ§Øª Ø¨ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ù…Ø´Ø±Ù Ø§Ù„Ø¹Ø§Ù….");
  if (committeeNumber < 1 || committeeNumber > 60) return showWarn("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ù„Ø¬Ù†Ø© Ø£ÙˆÙ„Ø§Ù‹.");
  
  let name = document.getElementById("voter-name").value.trim();
  if (!name) name = "Ø¨Ø¯ÙˆÙ† Ø§Ø³Ù…";
  
  const sel = Array.from(document.querySelectorAll('.candidate-checkbox:checked')).map(v => v.value);
  const val = document.querySelector('input[name="vvalid"]:checked');
  
  if (sel.length !== 2) return showWarn("ÙŠØ¬Ø¨ Ø§Ø®ØªÙŠØ§Ø± Ù…Ø±Ø´Ø­ÙŠÙ† Ø§Ø«Ù†ÙŠÙ† Ø¨Ø§Ù„Ø¶Ø¨Ø·");
  if (!val) return showWarn("Ø§Ø®ØªØ± Ø­Ø§Ù„Ø© Ø§Ù„ØµÙˆØª");
  
  const voteKey = Date.now();
  const voteRef = ref(db, "votes/" + voteKey);
  
  set(voteRef, {
    name: name,
    selected: sel,
    vote_validity: val.value,
    committee: committeeNumber,
    timestamp: voteKey
  }).then(() => {
    showConfirm("ØªÙ… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­!");
    document.getElementById("vote-form").reset();
    updateStyle();
    document.querySelectorAll(".radio-item").forEach(item => item.classList.remove("selected"));
  }).catch(err => {
    showWarn("Ø®Ø·Ø£: " + err.message);
  });
});

document.getElementById("password-input").addEventListener("keypress", function(e) {
  if (e.key === "Enter") checkPass();
});
</script>
</body>
</html>
